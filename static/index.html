<script>
    function request(url, type, params) {
        return new Promise(function (resolve, reject) {
            let xhr = new XMLHttpRequest();
            type = type.toLowerCase();
            type = (type == "post" ? "post" : "get");
            if (type == "get") {
                params = Object.keys(params).map(function (k) {
                    return encodeURIComponent(k) + '=' + encodeURIComponent(params[k])
                }).join('&');
            }
            xhr.open(type, url + (type == "post" ? "" : ("?" + params)), true);
            xhr.setRequestHeader('Content-Type', 'application/json');
            xhr.onreadystatechange = function () {
                if (xhr.readyState == XMLHttpRequest.DONE && xhr.status >= 400) {
                    let ress = xhr.response;
                    if (typeof res.errorCode !== 'undefined') {
                        reject(new Error('Something went wrong...'));
                    }
                }
                if (xhr.readyState == XMLHttpRequest.DONE && xhr.status == 200) {
                    let res = xhr.response;
                    resolve(res);
                }
                if (xhr.readyState == 2) {
                }
            }
            xhr.onload = function () {
                let res = xhr.response;
                resolve(res);
            };
            xhr.onerror = function () {
                reject(new Error('error'));
            };
            body = JSON.stringify({ params });
            xhr.send(body);
        }).then(data => {
            return (JSON.parse(data));
        });
    }
    function submit() {
        document.getElementById("output").value = "Loading...";
        request("/api", "POST", { text: document.getElementById("input").value }).then(value => {
            document.getElementById("output").value = value.keywords.toString().replace(/,/gi, "\n");
            if (document.getElementById("output").textContent == "") {
                document.getElementById("output").value = "No results";
            }
        });
    }
    function chooseArticle(i) {
        document.getElementById("input").value = articles[i].text;
    }
    window.onload = () => {
        request("/articles", "GET", {}).then(res => {
            window.articles = res.articles;
            res.articles.forEach((article, i) => {
                var elem = document.getElementById("articles");
                elem.innerHTML += `
                    <button onclick="chooseArticle(${i});">Load</button>
                    <span id="title${i}"></span> [<a id="link${i}" target="_blank">source</a>]
                    <br />
                `;
                document.getElementById(`title${i}`).textContent = article.title;
                document.getElementById(`link${i}`).href = article.source;
            });
        });
    }
    function clearBox() {
        document.getElementById("input").value = "";
    }
</script>
<style>
    textarea {
        width: 100%;
        max-width: 100%;
        background-color: #181a1b;
        color: white;
        max-height: 75vh;
        min-height: 5vh;
        min-width: 100%;
    }

    #left {
        float: left;
    }

    #right {
        float: right;
    }

    .panel {
        width: 47.5%;
    }

    body {
        background-color: #181a1b !important;
        color: white;
    }

    button {
        background-color: #181a1b;
        color: white;
        border-color: #575757;
    }

    #articles a {
        color: #3391ff;
    }
</style>
<div id="left" class="panel">
    Input Text:
    <button onclick=" clearBox()">
        Clear
    </button>
    <br />
    <br />
    <textarea rows="15" id="input">
</textarea>
    <br />
    <br />
    <button onclick="submit()">
        Run Extraction
    </button>
</div>
<div id="right" class="panel">
    Result:
    <br />
    <br />
    <textarea rows="5" id="output" readonly>Waiting for input.</textarea>
    <br />
    <br />
    Articles:
    <br />
    <br />
    <div id="articles">
    </div>
</div>